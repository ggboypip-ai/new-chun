<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ–°æ˜¥å›¢åœ†ç­¾ Â· æ¸©é¦¨äº’åŠ¨</title>
  <style>
    :root{
      font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Helvetica Neue",Arial,sans-serif;
      --bg1:#b91c1c; --bg2:#7f1d1d; --bg3:#3b0a0a;
      --gold:#fbbf24; --gold2:#f59e0b; --paper:#fff7ed;
      --ink:rgba(255,247,237,.92);
      --muted:rgba(255,247,237,.72);
      --panel:rgba(255,247,237,.10);
      --panel2:rgba(255,247,237,.14);
      --border:rgba(255,247,237,.25);
      --border2:rgba(255,247,237,.20);
      --shadow:0 16px 48px rgba(0,0,0,.35);
      --radius:18px;
    }
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(circle at 10% 20%, rgba(245,158,11,.20) 0%, rgba(0,0,0,0) 38%),
        radial-gradient(circle at 90% 22%, rgba(251,191,36,.16) 0%, rgba(0,0,0,0) 42%),
        radial-gradient(circle at 30% 92%, rgba(245,158,11,.14) 0%, rgba(0,0,0,0) 46%),
        linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
      overflow-x:hidden;
    }

    .wrap{max-width:620px;margin:0 auto;padding:16px;min-height:100vh;display:flex;position:relative;z-index:1;}
    .card{
      width:100%;
      margin:auto;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(6px);
    }
    .card:before,.card:after{
      content:"";
      position:absolute;
      width:280px;height:280px;border-radius:999px;filter:blur(18px);
      opacity:.35;pointer-events:none;
    }
    .card:before{background:rgba(245,158,11,.55);top:-160px;left:-140px;}
    .card:after{background:rgba(251,191,36,.45);bottom:-170px;right:-160px;}

    h1,h2{margin:0 0 10px;line-height:1.15;position:relative;z-index:2;}
    p{margin:8px 0;color:var(--ink);position:relative;z-index:2;}
    .muted{color:var(--muted);font-size:13px;position:relative;z-index:2;}
    .mini{font-size:13px;}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:10px;position:relative;z-index:2;}
    .hr{height:1px;background:rgba(255,247,237,.18);margin:14px 0;position:relative;z-index:2;}

    .badge{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 10px;border-radius:999px;
      background:rgba(255,247,237,.10);
      border:1px solid rgba(255,247,237,.20);
      font-size:12px;position:relative;z-index:2;
    }

    .btns{display:grid;gap:10px;margin-top:14px;position:relative;z-index:2;}
    button{
      appearance:none;border:0;border-radius:14px;padding:14px 14px;
      font-size:16px;font-weight:650;cursor:pointer;
      background:var(--panel2);color:var(--ink);
      border:1px solid rgba(255,247,237,.22);
      transition:transform .05s ease, background .2s ease;
      text-align:left;position:relative;z-index:2;
    }
    button:active{transform:scale(.99);background:rgba(255,247,237,.18);}
    .btnSmall{
      padding:10px 12px;font-size:14px;font-weight:650;border-radius:12px;
    }
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;position:relative;z-index:2;}
    .resultBox{
      background:rgba(255,247,237,.10);
      border:1px solid rgba(255,247,237,.20);
      border-radius:14px;padding:14px;margin-top:12px;position:relative;z-index:2;
    }
    .success{color:#a7f3d0;}
    .warn{color:#fde68a;}

    textarea{
      width:100%;min-height:120px;margin-top:10px;padding:12px;
      border-radius:12px;background:rgba(255,247,237,.10);
      border:1px solid rgba(255,247,237,.20);color:var(--ink);
      resize:vertical;box-sizing:border-box;outline:none;position:relative;z-index:2;
    }

    /* ===== æ˜¥èŠ‚åœºæ™¯è£…é¥°ï¼ˆçº¯CSS/SVGï¼‰===== */
    .scene{position:fixed;inset:0;pointer-events:none;z-index:0;}
    .lantern{
      position:absolute;top:-8px;width:96px;height:150px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
      opacity:.95;
      transform-origin: top center;
      animation: sway 4.6s ease-in-out infinite;
    }
    .lantern.l1{left:10px;animation-duration:4.8s;}
    .lantern.l2{right:10px;animation-duration:5.2s;animation-direction:reverse;}
    @keyframes sway{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}

    .couplet{
      position:absolute;top:120px;width:62px;height:58vh;
      background: linear-gradient(180deg, rgba(185,28,28,.95), rgba(127,29,29,.88));
      border:1px solid rgba(255,247,237,.25);
      border-radius:14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
      opacity:.92;
    }
    .couplet:before{
      content:"";
      position:absolute;inset:10px;
      border:1px dashed rgba(251,191,36,.55);
      border-radius:10px;
    }
    .couplet.left{left:10px;}
    .couplet.right{right:10px;}
    .couplet .txt{
      position:absolute;inset:18px 10px;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-weight:800;
      letter-spacing:4px;
      color: rgba(255,247,237,.92);
      font-size:16px;
    }
    .couplet .seal{
      position:absolute;bottom:14px;left:50%;transform:translateX(-50%);
      width:28px;height:28px;border-radius:8px;
      background: rgba(245,158,11,.65);
      border:1px solid rgba(255,247,237,.25);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }
    .banner{
      position:absolute;top:88px;left:50%;transform:translateX(-50%);
      padding:10px 16px;border-radius:999px;
      background: rgba(255,247,237,.10);
      border:1px solid rgba(255,247,237,.22);
      backdrop-filter: blur(4px);
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
      font-weight:800;
      letter-spacing:2px;
      color: rgba(255,247,237,.95);
      opacity:.9;
    }
    .firecrackers{
      position:absolute;bottom:16px;left:16px;
      width:130px;height:130px;
      opacity:.9;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.35));
    }
    .sparks{
      position:absolute;inset:0;opacity:.45;
      background-image:
        radial-gradient(circle at 10% 30%, rgba(251,191,36,.35) 0 2px, transparent 3px),
        radial-gradient(circle at 65% 18%, rgba(245,158,11,.35) 0 2px, transparent 3px),
        radial-gradient(circle at 82% 62%, rgba(251,191,36,.28) 0 2px, transparent 3px),
        radial-gradient(circle at 30% 74%, rgba(245,158,11,.28) 0 2px, transparent 3px),
        radial-gradient(circle at 50% 50%, rgba(251,191,36,.22) 0 2px, transparent 3px);
      animation: sparkle 6.5s ease-in-out infinite;
    }
    @keyframes sparkle{0%,100%{transform:translateY(0);opacity:.40}50%{transform:translateY(-10px);opacity:.60}}

    /* confettiï¼ˆç»“æœé¡µè§¦å‘ï¼‰ */
    .confetti{
      position:fixed;inset:0;pointer-events:none;z-index:50;overflow:hidden;
    }
    .confetti i{
      position:absolute;top:-10px;width:10px;height:14px;border-radius:3px;
      opacity:.9;
      animation: fall 1.2s linear forwards;
      transform: rotate(12deg);
    }
    @keyframes fall{
      to{transform: translateY(110vh) rotate(120deg);opacity:.95}
    }

    /* å°å±æ—¶éšè—å¯¹è”ï¼ˆé¿å…æŒ¡å†…å®¹ï¼‰ */
    @media (max-width: 520px){
      .couplet{display:none}
      .banner{top:70px}
    }
  </style>
</head>

<body>
  <!-- æ˜¥èŠ‚åœºæ™¯å±‚ï¼šç¯ç¬¼ã€æ˜¥è”ã€é­ç‚®ã€çƒŸèŠ±ç²’å­ -->
  <div class="scene" aria-hidden="true">
    <div class="sparks"></div>

    <!-- ç¯ç¬¼ SVGï¼ˆä¸¤ä¾§ï¼‰ -->
    <svg class="lantern l1" viewBox="0 0 120 190">
      <path d="M60 0 C58 12,58 12,60 24" stroke="rgba(255,247,237,.7)" stroke-width="3" fill="none"/>
      <circle cx="60" cy="28" r="9" fill="rgba(251,191,36,.75)" stroke="rgba(255,247,237,.35)"/>
      <path d="M35 40 C20 70,20 120,35 150 C50 175,70 175,85 150 C100 120,100 70,85 40 C70 20,50 20,35 40Z"
            fill="rgba(185,28,28,.96)" stroke="rgba(255,247,237,.28)" stroke-width="2"/>
      <path d="M45 48 C35 74,35 116,45 142" stroke="rgba(251,191,36,.28)" stroke-width="3" fill="none"/>
      <path d="M75 48 C85 74,85 116,75 142" stroke="rgba(251,191,36,.28)" stroke-width="3" fill="none"/>
      <rect x="44" y="148" width="32" height="14" rx="6" fill="rgba(251,191,36,.75)" stroke="rgba(255,247,237,.25)"/>
      <path d="M60 162 C60 172,56 180,50 186" stroke="rgba(255,247,237,.65)" stroke-width="3" fill="none"/>
      <path d="M60 162 C60 172,64 180,70 186" stroke="rgba(255,247,237,.65)" stroke-width="3" fill="none"/>
    </svg>

    <svg class="lantern l2" viewBox="0 0 120 190">
      <path d="M60 0 C58 12,58 12,60 24" stroke="rgba(255,247,237,.7)" stroke-width="3" fill="none"/>
      <circle cx="60" cy="28" r="9" fill="rgba(251,191,36,.75)" stroke="rgba(255,247,237,.35)"/>
      <path d="M35 40 C20 70,20 120,35 150 C50 175,70 175,85 150 C100 120,100 70,85 40 C70 20,50 20,35 40Z"
            fill="rgba(185,28,28,.96)" stroke="rgba(255,247,237,.28)" stroke-width="2"/>
      <path d="M45 48 C35 74,35 116,45 142" stroke="rgba(251,191,36,.28)" stroke-width="3" fill="none"/>
      <path d="M75 48 C85 74,85 116,75 142" stroke="rgba(251,191,36,.28)" stroke-width="3" fill="none"/>
      <rect x="44" y="148" width="32" height="14" rx="6" fill="rgba(251,191,36,.75)" stroke="rgba(255,247,237,.25)"/>
      <path d="M60 162 C60 172,56 180,50 186" stroke="rgba(255,247,237,.65)" stroke-width="3" fill="none"/>
      <path d="M60 162 C60 172,64 180,70 186" stroke="rgba(255,247,237,.65)" stroke-width="3" fill="none"/>
    </svg>

    <!-- å¯¹è” -->
    <div class="banner">æ–°æ˜¥å¿«ä¹ Â· é˜–å®¶å®‰åº·</div>
    <div class="couplet left">
      <div class="txt">æ˜¥é£é€æš–å…¥å± è‹</div>
      <div class="seal"></div>
    </div>
    <div class="couplet right">
      <div class="txt">çˆ†ç«¹å£°ä¸­ä¸€å²é™¤</div>
      <div class="seal"></div>
    </div>

    <!-- é­ç‚® SVGï¼ˆå·¦ä¸‹è§’ï¼‰ -->
    <svg class="firecrackers" viewBox="0 0 160 160">
      <rect x="18" y="22" width="26" height="108" rx="10" fill="rgba(185,28,28,.95)" stroke="rgba(255,247,237,.25)"/>
      <rect x="52" y="18" width="26" height="112" rx="10" fill="rgba(185,28,28,.92)" stroke="rgba(255,247,237,.25)"/>
      <rect x="86" y="24" width="26" height="106" rx="10" fill="rgba(185,28,28,.94)" stroke="rgba(255,247,237,.25)"/>
      <rect x="120" y="30" width="26" height="100" rx="10" fill="rgba(185,28,28,.90)" stroke="rgba(255,247,237,.25)"/>
      <rect x="18" y="18" width="128" height="10" rx="5" fill="rgba(251,191,36,.78)" stroke="rgba(255,247,237,.22)"/>
      <circle cx="18" cy="22" r="6" fill="rgba(251,191,36,.85)"/>
      <path d="M8 18 C18 6, 34 8, 44 2" stroke="rgba(255,247,237,.7)" stroke-width="3" fill="none"/>
      <circle cx="46" cy="2" r="3" fill="rgba(245,158,11,.9)"/>
    </svg>
  </div>

  <div class="wrap">
    <div class="card" id="app"></div>
  </div>

  <script>
    // =============================
    // 1) é¢˜åº“ï¼šæ¸©é¦¨äº’åŠ¨ï¼ˆ8é¢˜ï¼‰
    // =============================
    const questions = [
      { q:"é™¤å¤•å¤œï¼Œä½ æ›´æƒ³åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Ÿ", aText:"å’Œå®¶äººä¸€èµ·å‡†å¤‡å¹´å¤œé¥­", bText:"å®‰é™å¾…ä¸€ä¼šå„¿ï¼Œçœ‹çœ‹è¿™ä¸€å¹´çš„ç…§ç‰‡", aScore:+1, bScore:0 },
      { q:"ä½ æœ€å–œæ¬¢çš„â€œå¹´å‘³ç¬é—´â€æ˜¯ï¼Ÿ", aText:"å¨æˆ¿é‡Œçƒ­æ°”è…¾è…¾çš„é¦™å‘³", bText:"å®¢å…é‡Œå¤§å®¶è¯´ç¬‘çš„å£°éŸ³", aScore:+1, bScore:0 },
      { q:"é¥­æ¡Œä¸ŠèŠèµ·è¿‡å»çš„ä¸€å¹´ï¼Œä½ ä¼šï¼Ÿ", aText:"è®¤çœŸå¬ï¼Œå¶å°”å›åº”å‡ å¥", bText:"å¬ç€å°±å¥½ï¼Œå¿ƒé‡Œé»˜é»˜è®°ä¸‹", aScore:+1, bScore:0 },
      { q:"å½“å®¶äººå…³å¿ƒä½ çš„è¿‘å†µæ—¶ï¼Œä½ æ›´å€¾å‘ï¼Ÿ", aText:"æ…¢æ…¢è§£é‡Šï¼Œè®©ä»–ä»¬æ”¾å¿ƒ", bText:"å…ˆä¸è°ˆå¤ªå¤šï¼Œç­‰åˆé€‚çš„æ—¶å€™å†è¯´", aScore:+1, bScore:0 },
      { q:"ä½ æ›´æƒ³æŠŠæ—¶é—´ç•™ç»™è°ï¼Ÿ", aText:"é•¿è¾ˆ/å®¶äºº", bText:"è‡ªå·±ï¼ˆå……ç”µä¸€ä¸‹ï¼‰", aScore:+1, bScore:0 },
      { q:"èµ°äº²æˆšæ—¶ï¼Œä½ æ›´èˆ’æœçš„çŠ¶æ€æ˜¯ï¼Ÿ", aText:"çƒ­çƒ­é—¹é—¹åœ°å¯’æš„å‡ å¥", bText:"ç¤¼è²Œåˆ°ä½ï¼Œç„¶åæ—©ç‚¹å›å®¶", aScore:+1, bScore:0 },
      { q:"è¿™ä¸ªæ˜¥èŠ‚ï¼Œä½ æ›´æœŸå¾…çš„æ˜¯ï¼Ÿ", aText:"å’Œå®¶äººä¸€èµ·è¿‡å¹³å‡¡çš„å°æ—¥å­", bText:"ç»ˆäºèƒ½å¥½å¥½ä¼‘æ¯ä¸€ä¸‹", aScore:+1, bScore:0 },
      { q:"è¿™ä¸ªæ˜¥èŠ‚ï¼Œä½ æœ€æƒ³ç•™ä¸‹çš„æ˜¯ï¼Ÿ", aText:"å’Œå®¶äººåœ¨ä¸€èµ·çš„è®°å¿†", bText:"ä¸€ä»½ä¹…è¿çš„å®‰é™ä¸æ”¾æ¾", aScore:+1, bScore:0 },
    ];

    // =============================
    // 2) ç»“æœç­¾ï¼š6ç§ï¼ˆæ›´ç»†è…»ï¼‰
    // score èŒƒå›´ï¼š0~8
    // =============================
    function getResult(score){
      if(score >= 7) return {
        title:"ğŸ§§ å›¢åœ†çæƒœå‹",
        desc:"ä½ å¾ˆæ‡‚â€œåœ¨ä¸€èµ·â€çš„åˆ†é‡ã€‚è¿™ä¸ªæ˜¥èŠ‚ï¼Œä½ æ„¿æ„æ”¾æ…¢è„šæ­¥ï¼ŒæŠŠæ—¶é—´ç•™ç»™é‡è¦çš„äººã€‚",
        tag:"å›¢åœ† Â· é™ªä¼´ Â· æ¸©æƒ…",
        shareLine:"ä¸€å¹´èµ°å¾—å†è¿œï¼Œä¹Ÿè¿˜æ˜¯æƒ³å›å®¶åä¸€ä¼šå„¿ã€‚"
      };
      if(score >= 5) return {
        title:"ğŸµ æ¸©å’Œé™ªä¼´å‹",
        desc:"ä½ ä¸å¼ æ‰¬ï¼Œä½†å§‹ç»ˆåœ¨åœºã€‚ä½ ç”¨æœ€èˆ’æœçš„æ–¹å¼ï¼ŒæŠŠé™ªä¼´è½åœ¨ç»†èŠ‚é‡Œã€‚",
        tag:"å…‹åˆ¶ Â· ä½“è´´ Â· å®‰ç¨³",
        shareLine:"ä¸ä¸€å®šè¦è¯´å¾ˆå¤šè¯ï¼Œåœ¨ä¸€èµ·å°±å¾ˆå¥½ã€‚"
      };
      if(score >= 3) return {
        title:"ğŸ ç»†èŠ‚å®ˆæŠ¤å‹",
        desc:"ä½ æ›´åœ¨æ„é‚£äº›å°äº‹ï¼šä¸€å£°é—®å€™ã€ä¸€ç¢—çƒ­æ±¤ã€ä¸€æ®µæ•£æ­¥ã€‚ä½ åœ¨æ‚„æ‚„å®ˆæŠ¤å®¶çš„æ¸©åº¦ã€‚",
        tag:"ç»†è…» Â· å¯é  Â· ä½“é¢",
        shareLine:"å®¶ï¼Œæ˜¯æœ‰äººè®°å¾—ä½ å–œæ¬¢åƒä»€ä¹ˆã€‚"
      };
      if(score >= 2) return {
        title:"ğŸ•¯ï¸ é™é™æ„Ÿå—å‹",
        desc:"ä½ å–œæ¬¢åœ¨çƒ­é—¹é‡Œä¿ç•™ä¸€ç‚¹å®‰é™ã€‚ä½ åœ¨æ„Ÿå—å›¢åœ†ï¼Œä¹Ÿåœ¨ç…§é¡¾è‡ªå·±ã€‚",
        tag:"å®‰é™ Â· å†…çœ Â· æ²»æ„ˆ",
        shareLine:"çƒ­é—¹æ˜¯ä»–ä»¬çš„ï¼Œå®‰é™æ˜¯æˆ‘çš„ã€‚"
      };
      if(score >= 1) return {
        title:"ğŸŒ™ è‡ªæˆ‘ä¿®å¤å‹",
        desc:"è¿™ä¸€å¹´ä½ å·²ç»å¾ˆåŠªåŠ›äº†ã€‚è¿™ä¸ªæ˜¥èŠ‚ï¼Œä½ é€‰æ‹©æ…¢ä¸‹æ¥ï¼Œè®©è‡ªå·±å¥½å¥½ä¼‘æ¯ã€å†é‡æ–°å‡ºå‘ã€‚",
        tag:"ä¿®å¤ Â· æ”¾æ¾ Â· å›å½’",
        shareLine:"è¿™ä¸€å¹´å·²ç»å¾ˆåŠªåŠ›äº†ï¼Œå…ˆå¥½å¥½è¿‡å¹´ã€‚"
      };
      return {
        title:"ğŸ«¶ è½»è½»æ‹¥æŠ±å‹",
        desc:"ä½ å¯èƒ½ä¸å¤ªæƒ³ç¤¾äº¤ï¼Œä½†ä½ ä¾ç„¶æ„¿æ„æŠŠæ¸©æŸ”ç•™ç»™èº«è¾¹çš„äººã€‚ä½ éœ€è¦çš„æ˜¯â€œåˆšåˆšå¥½â€ã€‚",
        tag:"æ¾å¼› Â· è¾¹ç•Œ Â· æ¸©æŸ”",
        shareLine:"æŠŠè‡ªå·±ç…§é¡¾å¥½ï¼Œä¹Ÿæ˜¯å›¢åœ†çš„ä¸€éƒ¨åˆ†ã€‚"
      };
    }

    // =============================
    // 3) åˆ†äº«æ–‡æ¡ˆï¼ˆæ–¹æ¡ˆ2ï¼šåæƒ…ç»ªå…±é¸£ï¼‰
    // ä½ è¦æ±‚â€œæ¸©é¦¨æ˜¥èŠ‚äº’åŠ¨â€ï¼Œåˆ†äº«æ›´åƒäººè¯
    // =============================
    function buildShareText(r){
      return [
        `è¿™ä¸ªæ˜¥èŠ‚ï¼Œæˆ‘æŠ½åˆ°äº†ä¸€å¼ ã€Œ${r.title}ã€ã€‚`,
        ``,
        `${r.desc}`,
        ``,
        `æœ‰äº›è¯ï¼Œå¯èƒ½ä¸ä¸€å®šè¯´å‡ºå£ï¼Œä½†è¢«è®°ä½ã€è¢«ç†è§£ï¼Œå°±å·²ç»å¾ˆå¥½äº†ã€‚`,
        ``,
        `æ–°å¹´å¿«ä¹ ğŸŒ™`
      ].join("\n");
    }

    // =============================
    // 4) èƒŒæ™¯éŸ³ä¹ï¼ˆæˆ‘é€‰ï¼šäº”å£°éŸ³é˜¶â€œæ˜¥èŠ‚æ°›å›´â€åˆæˆå™¨ï¼‰
    // ä¸ä¾èµ–å¤–éƒ¨MP3ï¼Œç¦»çº¿å¯ç”¨
    // è¯´æ˜ï¼šæµè§ˆå™¨å¿…é¡»ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾ï¼ˆç‚¹å‡»â€œå¼€å§‹â€è§¦å‘ï¼‰
    // =============================
    const Music = (() => {
      let ctx = null;
      let master = null;
      let playing = false;
      let timer = null;

      // Cå¤§è°ƒäº”å£°éŸ³é˜¶ï¼ˆåâ€œå¹´å‘³â€çš„ç¨³é‡æ„Ÿï¼‰ï¼šC D E G Aï¼ˆæ¢å…«åº¦ï¼‰
      const scale = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25];
      // ç®€å•å¾ªç¯æ—‹å¾‹ï¼ˆæ¸©å’Œã€å›¢åœ†ï¼‰
      const pattern = [0,2,3,2, 0,2,4,3, 2,1,0,1, 3,2,0,null];

      function init(){
        if(ctx) return;
        ctx = new (window.AudioContext || window.webkitAudioContext)();
        master = ctx.createGain();
        master.gain.value = 0.12; // é»˜è®¤éŸ³é‡ï¼Œæ¸©å’Œä¸åµ
        master.connect(ctx.destination);
      }

      function pluck(freq, t){
        // ç®€å•â€œæœ¨é±¼/å¤ç­æ„Ÿâ€çš„æŸ”å’ŒéŸ³è‰²
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.type = "triangle";
        osc.frequency.setValueAtTime(freq, t);

        // åŒ…ç»œï¼šå¿«é€Ÿèµ·éŸ³ï¼Œç¼“æ…¢è¡°å‡
        gain.gain.setValueAtTime(0.0001, t);
        gain.gain.exponentialRampToValueAtTime(0.30, t + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.38);

        osc.connect(gain);
        gain.connect(master);

        osc.start(t);
        osc.stop(t + 0.40);
      }

      function start(){
        init();
        if(playing) return;
        playing = true;

        // è‹¥è¢«æš‚åœï¼Œæ¢å¤
        if(ctx.state === "suspended") ctx.resume();

        let step = 0;
        const bpm = 92; // æ¸©é¦¨æ…¢èŠ‚å¥
        const interval = (60 / bpm) / 2; // å…«åˆ†éŸ³ç¬¦

        const tick = () => {
          if(!playing) return;
          const now = ctx.currentTime;
          const noteIndex = pattern[step % pattern.length];
          if(noteIndex !== null){
            const f = scale[noteIndex % scale.length];
            pluck(f, now + 0.01);
            // å¶å°”åŠ ä¸€ç‚¹é«˜å…«åº¦ç‚¹ç¼€ï¼ˆåƒç¯ç¬¼å…‰ï¼‰
            if(step % 8 === 4) pluck(f * 2, now + 0.01);
          }
          step++;
          timer = setTimeout(tick, interval * 1000);
        };
        tick();
      }

      function stop(){
        playing = false;
        if(timer) clearTimeout(timer);
        timer = null;
      }

      function toggle(){
        if(playing) stop();
        else start();
        return playing;
      }

      function setVolume(v){
        init();
        master.gain.value = Math.max(0, Math.min(0.35, v));
      }

      function isPlaying(){ return playing; }

      return { start, stop, toggle, setVolume, isPlaying };
    })();

    // =============================
    // 5) App UI
    // =============================
    const app = document.getElementById("app");
    let idx = 0;
    let score = 0;
    let picks = [];

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderStart(){
      app.innerHTML = `
        <div class="badge">ğŸ§¨ æ¸©é¦¨äº’åŠ¨ <span class="muted">Â· çº¦ 2 åˆ†é’Ÿ</span></div>
        <h1 style="margin-top:12px;">æ–°æ˜¥å›¢åœ†ç­¾</h1>
        <p>
          åˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„æ˜¥èŠ‚ã€‚<br/>
          ä¸ç®¡è¿™ä¸€å¹´è¿‡å¾—æ€ä¹ˆæ ·ï¼Œ<br/>
          è¿™å‡ å¤©ï¼Œéƒ½æ˜¯å±äºâ€œå›å®¶â€å’Œâ€œåœ¨ä¸€èµ·â€çš„æ—¶é—´ã€‚<br/>
          åšå‡ ä¸ªå°é€‰æ‹©ï¼Œç”Ÿæˆä½ çš„å›¢åœ†çŠ¶æ€ç­¾ã€‚
        </p>

        <div class="toolbar">
          <button class="btnSmall" id="musicBtn">ğŸµ éŸ³ä¹ï¼šå…³</button>
          <button class="btnSmall" id="blessBtn">ğŸ§§ æŠ½ä¸€å¥ç¥ç¦</button>
        </div>

        <div class="hr"></div>

        <div class="btns">
          <button id="startBtn">â–¶ å¼€å§‹</button>
        </div>

        <p class="muted mini">æç¤ºï¼šéŸ³ä¹ä¼šåœ¨ä½ ç‚¹å‡»å¼€å§‹åæ’­æ”¾ï¼ˆæµè§ˆå™¨è§„åˆ™ï¼‰ã€‚</p>
        <p class="muted mini">æœ¬é¡µçº¯å‰ç«¯ï¼Œä¸æ”¶é›†æ•°æ®ã€‚</p>
      `;

      document.getElementById("startBtn").onclick = () => {
        // ç‚¹å‡»å¼€å§‹åï¼šè‡ªåŠ¨å¼€éŸ³ä¹ï¼ˆæ›´åƒâ€œæ˜¥èŠ‚äº’åŠ¨â€ï¼‰
        if(!Music.isPlaying()) {
          try { Music.start(); } catch(e) {}
        }
        idx=0; score=0; picks=[];
        renderQuestion();
      };

      document.getElementById("musicBtn").onclick = () => {
        let on=false;
        try { on = Music.toggle(); } catch(e) { on=false; }
        document.getElementById("musicBtn").textContent = on ? "ğŸµ éŸ³ä¹ï¼šå¼€" : "ğŸµ éŸ³ä¹ï¼šå…³";
      };

      document.getElementById("blessBtn").onclick = () => {
        const line = randomBlessing();
        popConfetti(36);
        alert(line);
      };
    }

    function renderQuestion(){
      const total = questions.length;
      const item = questions[idx];
      const progress = Math.round(((idx + 1) / total) * 100); // âœ… ä¿®æ­£ï¼šæœ€åä¸€é¢˜æ˜¾ç¤º100%

      app.innerHTML = `
        <div class="row">
          <div class="badge">ğŸ¯ ç¬¬ ${idx+1} / ${total} é¢˜</div>
          <div class="muted">è¿›åº¦ ${progress}%</div>
        </div>

        <h2 style="margin-top:12px;">${escapeHtml(item.q)}</h2>

        <div class="btns">
          <button id="aBtn">A. ${escapeHtml(item.aText)}</button>
          <button id="bBtn">B. ${escapeHtml(item.bText)}</button>
        </div>

        <div class="toolbar">
          <button class="btnSmall" id="musicBtn">ğŸµ éŸ³ä¹ï¼š${Music.isPlaying() ? "å¼€" : "å…³"}</button>
          <button class="btnSmall" id="blessBtn">ğŸ§§ æŠ½ä¸€å¥ç¥ç¦</button>
        </div>

        <p class="muted mini">åšå®Œä¼šç”Ÿæˆä½ çš„æ–°æ˜¥ç­¾ï¼Œå¹¶å¯ä¸€é”®å¤åˆ¶åˆ†äº«ã€‚</p>
      `;

      document.getElementById("aBtn").onclick = () => choose("A");
      document.getElementById("bBtn").onclick = () => choose("B");

      document.getElementById("musicBtn").onclick = () => {
        let on=false;
        try { on = Music.toggle(); } catch(e) { on=false; }
        document.getElementById("musicBtn").textContent = `ğŸµ éŸ³ä¹ï¼š${on ? "å¼€" : "å…³"}`;
      };

      document.getElementById("blessBtn").onclick = () => {
        const line = randomBlessing();
        popConfetti(28);
        alert(line);
      };
    }

    function choose(which){
      const item = questions[idx];
      if(which === "A") score += item.aScore;
      else score += item.bScore;
      picks.push(which);
      idx++;
      if(idx >= questions.length) renderResult();
      else renderQuestion();
    }

    function renderResult(){
      const r = getResult(score);
      const shareText = buildShareText(r);

      app.innerHTML = `
        <div class="badge">ğŸ§§ ç»“æœå·²ç”Ÿæˆ</div>
        <h1 style="margin-top:12px;">${escapeHtml(r.title)}</h1>
        <p>${escapeHtml(r.desc)}</p>

        <div class="resultBox">
          <div class="muted mini">ä½ çš„æ ‡ç­¾ï¼š${escapeHtml(r.tag)}</div>
          <div class="muted mini">ä½ çš„â€œç­¾å¥â€ï¼š${escapeHtml(r.shareLine)}</div>
          <div class="muted mini">é€‰æ‹©åºåˆ—ï¼š${picks.join(" - ")}</div>
        </div>

        <div class="btns" style="margin-top:14px;">
          <button id="copyBtn">ğŸ“‹ å¤åˆ¶åˆ†äº«æ–‡æ¡ˆï¼ˆæ¸©é¦¨ç‰ˆï¼‰</button>
          <button id="blessBtn2">ğŸ§§ é€ä¸€å¥ç¥ç¦</button>
          <button id="retryBtn">ğŸ” å†æµ‹ä¸€æ¬¡</button>
        </div>

        <div class="toolbar">
          <button class="btnSmall" id="musicBtn">ğŸµ éŸ³ä¹ï¼š${Music.isPlaying() ? "å¼€" : "å…³"}</button>
        </div>

        <p class="muted mini" id="msg" style="margin-top:10px;"></p>
        <div id="fallback" style="display:none;">
          <p class="muted mini warn" style="margin-top:10px;">å¦‚æœæ— æ³•è‡ªåŠ¨å¤åˆ¶ï¼šè¯·é•¿æŒ‰/å…¨é€‰ä¸‹é¢æ–‡å­—æ‰‹åŠ¨å¤åˆ¶</p>
          <textarea id="ta" readonly></textarea>
        </div>
      `;

      document.getElementById("retryBtn").onclick = () => { popConfetti(24); renderStart(); };
      document.getElementById("musicBtn").onclick = () => {
        let on=false;
        try { on = Music.toggle(); } catch(e) { on=false; }
        document.getElementById("musicBtn").textContent = `ğŸµ éŸ³ä¹ï¼š${on ? "å¼€" : "å…³"}`;
      };

      document.getElementById("blessBtn2").onclick = () => {
        popConfetti(60);
        alert(randomBlessing());
      };

      document.getElementById("copyBtn").onclick = async () => {
        const msg = document.getElementById("msg");
        const fb = document.getElementById("fallback");
        const ta = document.getElementById("ta");
        try{
          await navigator.clipboard.writeText(shareText);
          fb.style.display="none";
          popConfetti(70);
          msg.innerHTML = `<span class="success">å·²å¤åˆ¶ï¼</span> å»å¾®ä¿¡/æœ‹å‹åœˆç²˜è´´å°±è¡Œã€‚`;
        }catch(e){
          ta.value = shareText;
          fb.style.display="block";
          msg.innerHTML = `<span class="warn">è‡ªåŠ¨å¤åˆ¶å¤±è´¥</span>ï¼ˆæµè§ˆå™¨æƒé™é™åˆ¶ï¼‰ã€‚å·²å±•å¼€æ‰‹åŠ¨å¤åˆ¶æ¡†ã€‚`;
          setTimeout(() => { ta.focus(); ta.select(); }, 60);
        }
      };

      // ç»“æœé¡µæ¥ç‚¹â€œå¹´å‘³â€
      popConfetti(46);
    }

    // =============================
    // 6) ç¥ç¦è¯­æ± ï¼ˆæ›´åƒæ˜¥èŠ‚ï¼‰
    // =============================
    const blessings = [
      "æ„¿ä½ æ–°çš„ä¸€å¹´ï¼šå®¶äººå®‰åº·ï¼Œç¯ç«å¯äº²ï¼Œä¸‡äº‹é¡ºæ„ã€‚",
      "æ„¿ä½ å›å®¶çš„è·¯ä¸æ‹¥æŒ¤ï¼Œé¥­æ¡Œä¸Šçš„ç¬‘å£°æ›´ä¹…ä¸€ç‚¹ã€‚",
      "æ„¿ä½ æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ‰€è¡Œçš†å¦é€”ï¼Œæ‰€é‡çš†æ¸©æŸ”ã€‚",
      "æ„¿ä½ æœ‰çƒ­æ±¤å¯æš–èƒƒï¼Œæœ‰å®¶äººå¯æƒ¦å¿µï¼Œæœ‰æœªæ¥å¯æœŸå¾…ã€‚",
      "æ„¿ä½ æŠŠç–²æƒ«ç•™åœ¨æ—§å¹´ï¼ŒæŠŠæ¸©æŸ”å¸¦è¿›æ–°å¹´ã€‚",
      "æ„¿ä½ é˜–å®¶å›¢åœ†ï¼Œå¹³å®‰å–œä¹ï¼Œå²å²å¸¸æ¬¢æ„‰ã€‚",
      "æ„¿ä½ ç¯ç¬¼å¸¸äº®ã€å¹´å‘³å¸¸åœ¨ï¼Œå¿ƒé‡Œæ€»æœ‰å½’å¤„ã€‚",
      "æ„¿ä½ æ–°å²ä¸æ…Œä¸å¿™ï¼ŒæŠŠæ—¥å­è¿‡æˆå–œæ¬¢çš„æ ·å­ã€‚"
    ];
    function randomBlessing(){
      return "ğŸ§§ " + blessings[Math.floor(Math.random() * blessings.length)];
    }

    // =============================
    // 7) Confettiï¼ˆè½»é‡ã€æ— ä¾èµ–ï¼‰
    // =============================
    function popConfetti(n=40){
      const layer = document.createElement("div");
      layer.className = "confetti";
      const colors = [
        "rgba(251,191,36,.95)",
        "rgba(245,158,11,.95)",
        "rgba(255,247,237,.90)",
        "rgba(185,28,28,.85)"
      ];
      for(let i=0;i<n;i++){
        const p = document.createElement("i");
        const left = Math.random() * 100;
        const delay = Math.random() * 0.25;
        const dur = 0.9 + Math.random() * 0.7;
        const size = 8 + Math.random()*10;
        p.style.left = left + "vw";
        p.style.animationDelay = delay + "s";
        p.style.animationDuration = dur + "s";
        p.style.width = (size*0.7) + "px";
        p.style.height = (size) + "px";
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);
        layer.appendChild(p);
      }
      document.body.appendChild(layer);
      setTimeout(()=>layer.remove(), 1800);
    }

    // å¯åŠ¨
    renderStart();
  </script>
</body>
</html>
